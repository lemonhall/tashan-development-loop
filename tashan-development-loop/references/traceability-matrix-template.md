# 追溯矩阵模板（PRD ↔ 计划 ↔ 测试 ↔ 证据 ↔ 代码）

> 目的：把“设计图（PRD）”与“施工计划（vN）”以及“可验证证据”串成一条链，防止文档漂移与返工。  
> 原则：任何一条需求或计划，只要在链路中出现断点，就必须补齐（或明确声明为 out-of-scope）。

## 0) 使用说明

- **放置位置建议**：
  - 轻量：放在 `docs/plan/vN-index.md` 的 “追溯矩阵” 小节
  - 重量：单独文件 `docs/traceability/<topic>.md`，并在 `vN-index` 链接
- **维护节奏**：
  - 写 PRD 后：先填 `Req ID -> 预期交付版本`（哪怕是 TBD）
  - 写 vN 计划时：补齐 `vN 条目 -> tests/commands`
  - 每次交付后：补齐 `证据 -> commit/tag/产物路径`

## 1) PRD → vN → 验证 → 证据（按需求）

| Req ID | 需求摘要 | vN 版本 | vN 计划条目 | tests / commands（验证入口） | 证据（产物/日志/截图/commit） | 关键代码路径（可选） | 状态 |
|---|---|---|---|---|---|---|---|
| REQ-001 |  | v10 | v10-01-xxx.md | `...` | `...` | `...` | todo/doing/done |

**填表规则（硬性建议）**

- `tests / commands` 必须是可重复执行的命令或测试文件路径，不接受“手测”“应该可以”。
- `证据` 必须是可定位的东西：产物文件路径、日志关键词、commit hash、截图文件路径等。
- 如果某条需求明确后置：`vN 版本` 填 `vNext`，并在 `状态` 写 `deferred`，同时在 PRD 标注。

## 2) vN 计划 → PRD（按计划）

> 这个表用于反向检查：计划是不是“有出处”，以及是否存在“计划漂移成自嗨”。

| vN 计划条目 | PRD Trace（Req IDs 或说明） | 验收口径（摘要） | tests / commands | 状态 |
|---|---|---|---|---|
| v10-01-offline-encounters.md | REQ-002, REQ-007 |  | `...` | todo/doing/done |

## 3) 断链诊断（写完表以后必须做一次）

- PRD 有 `REQ-*`，但矩阵里找不到对应 vN 条目 → **断链**（计划缺失或需求未分解）
- vN 计划条目找不到 `REQ-*` → **断链**（计划无出处，需写明“基础设施/偿债”的理由）
- 有验收，但没有可执行验证命令 → **断链**（验收不硬）
- 有验证命令，但没有证据落点 → **断链**（交付不可追溯）

